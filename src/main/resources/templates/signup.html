<meta charset="UTF-8">
<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
    <div th:replace="fragments/head.html"></div>
    <link rel="stylesheet" type="text/css" href="/css/signup.css">
    <title>회원가입 페이지</title>
</head>
<body>
<div id="login-form">
    <div id="login-title">회원가입</div>

    <form method="post">
        <div class="login-id-label">E-mail</div>
        <input type="text" id="email" placeholder="example@example.com" class="login-input-box" oninput = "checkEmail()">
        <div>
            <d id="emailAvailable" class="valid-feedback" style="display:none;"></d>
            <d id="emailNotAvailable" class="invalid-feedback" style="display:none;"></d>
        </div>

        <div class="login-id-label">Nickname</div>
        <input type="text" id="nickname" placeholder="4~12자를 입력해주세요." class="login-input-box" oninput = "checkNickname()">
        <div>
            <d id="nicknameAvailable" class="valid-feedback" style="display:none;"></d>
            <d id="nicknameNotAvailable" class="invalid-feedback" style="display:none;"></d>
        </div>

        <div class="login-id-label">Password</div>
        <input type="password" id="password" placeholder="숫자와 영어로 4~12자를 입력해주세요." class="login-input-box">

    </form>
    <button id="login-id-submit" onclick="click_signup()">회원 가입</button>
</div>
</body>
<script>
    function checkEmail() {
        $.ajax({
            type: 'POST',
            url: '/api/user/emailcheck',
            contentType: 'application/json; charset=utf-8',
            data: $('#email').val(),
            success: function (result) {
                console.log(result)
                $('#emailAvailable').show().text(result).append($('<br />'));
                $('#emailNotAvailable').hide();
                console.log(result)
            }, error: function (request, status, error) {
                $('#emailAvailable').hide();
                $('#emailNotAvailable').show().text('이미 사용중인 이메일 입니다.').append($('<br />'));
            }
        });
    }

    function checkNickname() {
        $.ajax({
            type: 'POST',
            url: '/api/user/nicknamecheck',
            contentType: 'application/json; charset=utf-8',
            data: $('#nickname').val(),
            success: function (result) {
                console.log(result)
                // 성공 시 실패 메시지 hide, 성공 메시지 show
                $('#nicknameAvailable').show().text(result).append($('<br />'));
                $('#nicknameNotAvailable').hide();
                console.log(result)
            }, error: function (request, status, error) {
                // 실패 시 실패 메시지 show, 성공 메시지 hide
                $('#nicknameAvailable').hide();
                $('#nicknameNotAvailable').show().text('이미 사용중인 닉네임 입니다.').append($('<br />'));
            }
        });
    }

    function click_signup() {
        let email = $('#email').val();
        let nickname = $('#nickname').val();
        let password = $('#password').val();

        let reg_email =/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/;
        let reg_nickname = /^[a-z0-9_-]{4,12}$/;
        let reg_password = /(?=.*\d)(?=.*[a-zA-ZS]).{4,12}/;

        if (email === '' || nickname === '' || password === '') {
            alert("내용을 입력해주세요")
            return;
        }

        if(!reg_email.test(email)) {
            alert("올바른 이메일 주소를 입력해주세요.")
            return;
        }

        if(!reg_nickname.test(nickname)) {
            alert("4~12자리의 닉네임을 입력해주세요.")
            return;
        }

        if(!reg_password.test(password)) {
            alert("문자와 숫자를 한개 이상 포함한 비밀번호를 입력해주세요.")
            return;
        }

        let data = {'email': email, 'nickname': nickname, 'password': password};
        $.ajax({
            type: "POST",
            url: "/api/user/signup",
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            data: JSON.stringify(data),
            success: function (response) {
                location.href="/login";
            }
        });
    }
</script>
</html>